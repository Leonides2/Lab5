name: Despliegue a Azure Container App

on:
  # El segundo workflow debe escuchar el evento 'repository_dispatch'
  repository_dispatch:
    types: [deploy_azure_container]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Azure Login
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}
          
      # 2. Despliegue a Azure Container App
      - name: Desplegar imagen a Azure Container App
        uses: azure/container-apps-deploy-action@v1
        with:
          # Sustituye estos valores con los de tu entorno Azure
          resourceGroup: 'UNA-CHAT'
          containerAppName: 'una-chat-app'
          # Se usa el tag de la imagen que se ley√≥ del evento disparador
          imageToDeploy: ${{ secrets.DOCKER_USERNAME }}/lab5:latest
          targetPort: 3000
          

          environmentVariables: PORT=3000 NODE_ENV=production